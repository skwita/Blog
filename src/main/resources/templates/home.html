<!DOCTYPE html>
<html lang="en"
      xmlns:="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Blog</title>
    <link rel="stylesheet" th:href="@{/css/home.css}">
</head>
<body>

<div class="header">
  <div>
    <h1>
      <a th:href="@{/}" class="blogName">Skwita Blog</a>
    </h1>
  </div>
  <div class="buttons">
    <a class="authThing button" th:if="${user == null}" th:href="@{/login}">Sign in</a>
    <a class="authThing button" th:if="${user == null}" th:href="@{/register}">Sign up</a>
    <a class="authThing username" th:if="${user != null}" th:href="@{/user/{userID}(userID = ${user.getId()})}" th:text="${user.getUsername()}"></a>
    <form th:if="${user != null}" th:action="@{/logout}" th:method="POST">
      <input class="authThing button"  type="submit" value="logout">
    </form>
  </div>
</div>

<div class="postsContainer">
  <div class="post" th:each="post:${posts}">
    <p class="title field" th:text="${post.getTitle()}">TITLE</p>
    <a class="author field" th:text="${post.getUser().getUsername()}" th:href="@{/user/{userID}(userID = ${post.getUser().getId()})}">USER</a>
    <p class="text field" th:text="${post.getText()}">TEXT</p>
    <p th:text="${post.getUserLikes().size()}"></p>
    <form th:if="${user != null}" th:action="@{/{id}/like(id=${post.getId()})}" th:method="PATCH">
      <input class="authThing button"  type="submit" value="like">
    </form>
    <div class="buttons">
      <form th:if="${user != null && (post.getUser().getId() == user.getId() || #authorization.expression('hasRole(''ROLE_ADMIN'')'))}" th:action="@{/edit/{id}(id=*{post.getId()})}" th:method="GET">
        <input class="button" type="submit" value="Edit post">
      </form>
      <form th:if="${user != null && (post.getUser().getId() == user.getId() || #authorization.expression('hasRole(''ROLE_ADMIN'')'))}" th:action="@{/delete/{id}(id=*{post.getId()})}" th:method="DELETE">
        <input class="button" type="submit" value="Delete post">
      </form>
    </div>
  </div>
</div>

<div class="postCreation">
  <form th:if="${user != null}" th:action="@{/new}" th:method="GET">
    <input class="button" type="submit" value="New Post">
  </form>
</div>
</body>
</html>